@model IEnumerable<WebBanTaiKhoan.Models.TopUpTransaction>
@{
    ViewData["Title"] = "Lịch sử nạp tiền";
    // Tách dữ liệu tại View
    var bankHistory = Model.Where(t => string.IsNullOrWhiteSpace(t.Serial)).ToList();
    var cardHistory = Model.Where(t => !string.IsNullOrWhiteSpace(t.Serial)).ToList();
}

<div class="container mt-4 pb-5">
    <div class="mb-4 d-flex justify-content-between align-items-center">
        <h3 class="fw-bold text-dark"><i class="fa-solid fa-clock-rotate-left me-2 text-primary"></i>LỊCH SỬ NẠP TIỀN</h3>
        <a asp-action="MyOrders" class="btn btn-outline-primary btn-sm rounded-pill px-3 shadow-sm">Xem lịch sử mua</a>
    </div>

    @* --- 🔵 THANH TAB NGANG --- *@
    <div class="bg-white p-2 rounded-pill shadow-sm mb-4 d-flex justify-content-center border">
        <ul class="nav nav-pills border-0" id="historyTab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active rounded-pill fw-bold px-4" data-bs-toggle="pill" data-bs-target="#hist-bank" type="button">BANKING / QR</button>
            </li>
            <li class="nav-item">
                <button class="nav-link rounded-pill fw-bold px-4" data-bs-toggle="pill" data-bs-target="#hist-card" type="button">THẺ CÀO</button>
            </li>
        </ul>
    </div>

    <div class="tab-content">
        @* TAB BANK *@
        <div class="tab-pane fade show active" id="hist-bank">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr class="small fw-bold text-uppercase">
                            <th class="ps-4">Mã giao dịch</th>
                            <th>Số tiền</th>
                            <th>Trạng thái</th>
                            <th class="text-end pe-4">Thời gian</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var t in bankHistory)
                        {
                            <tr>
                                <td class="ps-4">#@t.TransactionCode</td>
                                <td class="text-success fw-bold">+@t.Amount.ToString("#,##0")đ</td>
                                <td>@Html.Raw(GetStatusBadge(t.Status))</td>
                                <td class="text-end pe-4 small text-muted">@t.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        @* TAB CARD *@
        <div class="tab-pane fade" id="hist-card">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr class="small fw-bold text-uppercase">
                            <th class="ps-4">Chi tiết thẻ</th>
                            <th>Mệnh giá</th>
                            <th>Trạng thái</th>
                            <th class="text-end pe-4">Loại thẻ / Ngày</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var t in cardHistory)
                        {
                            <tr>
                                <td class="ps-4">
                                    <div class="small">S: @t.Serial</div>
                                    <div class="small text-danger fw-bold">M: @t.Pin</div>
                                </td>
                                <td class="text-success fw-bold">+@t.Amount.ToString("#,##0")đ</td>
                                <td>@Html.Raw(GetStatusBadge(t.Status))</td>
                                <td class="text-end pe-4">
                                    <div class="small fw-bold">@t.Method.Replace("Thẻ cào", "")</div>
                                    <div class="x-small text-muted">@t.CreatedAt.ToString("dd/MM/yyyy")</div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@functions {
    public string GetStatusBadge(string status)
    {
        if (status == "Success") return "<span class='badge bg-success-subtle text-success rounded-pill px-3'>Thành công</span>";
        if (status == "Pending" || status == "Processing") return "<span class='badge bg-warning-subtle text-warning rounded-pill px-3'>Đang chờ</span>";
        return "<span class='badge bg-danger-subtle text-danger rounded-pill px-3'>Đã hủy</span>";
    }
}

<style>
    .rounded-4 {
        border-radius: 1rem !important;
    }

    .nav-pills .nav-link.active {
        background-color: #0d6efd;
        color: white;
    }

    .bg-success-subtle {
        background-color: #e8f5e9 !important;
    }

    .bg-warning-subtle {
        background-color: #fff8e1 !important;
    }

    .bg-danger-subtle {
        background-color: #ffebee !important;
    }
</style>